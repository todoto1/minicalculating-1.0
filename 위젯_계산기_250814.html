<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>투두투 미니 계산기</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/static/pretendard.css">
<style>
  * { box-sizing: border-box; }

  body {
    margin: 0;
    padding: 20px;
    font-family: 'Pretendard', sans-serif;
    background: transparent;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .widget {
    background: #ffffff;
    border-radius: 32px;
    padding: 16px; /* 세로 패딩 줄임 */
    box-shadow: 0 8px 32px rgba(0,0,0,0.06);
    border: 1px solid rgba(0,0,0,0.04);
    width: 200px; /* 컴팩트 */
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .display {
    width: 100%;
    height: 44px; /* 높이 축소 */
    background: #ffffff; /* 흰색 배경 */
    border-radius: 12px;
    text-align: right;
    font-size: 18px;
    font-family: 'Pretendard', sans-serif;
    padding: 6px 10px; /* 패딩 축소 */
    margin-bottom: 0;
    color: #000;
    border: none; /* 테두리 제거 */
  }

  .buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 6px;
  }

  /* 숫자 키 */
  .key {
    height: 38px;
    font-size: 14px;
    font-weight: 600;
    border: none; /* 테두리 없음 */
    border-radius: 10px;
    cursor: pointer;
    font-family: 'Pretendard', sans-serif;
    background: #ffffff;
    color: #333;
    transition: background 0.15s, transform 0.1s, box-shadow 0.1s;
  }
  .key:hover {
    background: #f0f0f0;
  }

  /* 기능키 */
  .function-key {
    background: #f3f3f3;
    color: #333;
    border-radius: 14px; /* 라운드  */
  }
  .function-key:hover {
    background: #e8e8e8;
  }

  /* = 키 */
  .equal {
    background: #000cfe;
    color: white;
    grid-column: span 2;
   border-radius: 14px; /* 라운드 */
  }
  .equal:hover {
    background: #1a1cff;
  }
</style>
</head>
<body>
<div class="widget">
  <input type="text" class="display" id="display" placeholder="0" readonly>
  <div class="buttons">
    <button class="key function-key" onclick="allClear()">AC</button>
    <button class="key function-key" onclick="clearDisplay()">C</button>
    <button class="key function-key" onclick="appendValue('%')">%</button>
    <button class="key function-key" onclick="appendValue('/')">÷</button>

    <button class="key" onclick="appendValue('7')">7</button>
    <button class="key" onclick="appendValue('8')">8</button>
    <button class="key" onclick="appendValue('9')">9</button>
    <button class="key function-key" onclick="appendValue('*')">×</button>

    <button class="key" onclick="appendValue('4')">4</button>
    <button class="key" onclick="appendValue('5')">5</button>
    <button class="key" onclick="appendValue('6')">6</button>
    <button class="key function-key" onclick="appendValue('-')">−</button>

    <button class="key" onclick="appendValue('1')">1</button>
    <button class="key" onclick="appendValue('2')">2</button>
    <button class="key" onclick="appendValue('3')">3</button>
    <button class="key function-key" onclick="appendValue('+')">＋</button>

    <button class="key" onclick="appendValue('0')">0</button>
    <button class="key" onclick="appendValue('.')">.</button>
    <button class="key equal" onclick="calculate()">＝</button>
  </div>
</div>

<script>
const display = document.getElementById("display");

function formatInput(expression) {
  return expression.replace(/\d+(\.\d+)?/g, (num) => {
    if (num.includes(".")) {
      const parts = num.split(".");
      parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      return parts.join(".");
    }
    return num.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  });
}

function appendValue(value) {
  let raw = display.dataset.raw || "";
  raw += value;
  display.dataset.raw = raw;
  display.value = formatInput(raw);
}

function clearDisplay() {
  let raw = display.dataset.raw || "";
  raw = raw.slice(0, -1);
  display.dataset.raw = raw;
  display.value = formatInput(raw);
}

function allClear() {
  display.dataset.raw = "";
  display.value = "";
}

function formatNumber(num) {
  if (isNaN(num)) return "Error";
  const parts = num.toString().split(".");
  parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  return parts.join(".");
}

function calculate() {
  try {
    const raw = (display.dataset.raw || "").replace(/%/g, "/100");
    const result = eval(raw);
    display.dataset.raw = result.toString();
    display.value = formatNumber(result);
  } catch {
    display.value = "Error";
  }
}

/* 키보드 입력 & 버튼 눌림 효과 */
document.addEventListener("keydown", (e) => {
  let keyElement = null;

  if ((/[0-9]/).test(e.key)) {
    keyElement = [...document.querySelectorAll('.key')].find(btn => btn.textContent.trim() === e.key);
    appendValue(e.key);
  } else if (e.key === '+') {
    keyElement = [...document.querySelectorAll('.function-key')].find(btn => btn.textContent.includes('+'));
    appendValue('+');
  } else if (e.key === '-') {
    keyElement = [...document.querySelectorAll('.function-key')].find(btn => btn.textContent.includes('−'));
    appendValue('-');
  } else if (e.key === '*') {
    keyElement = [...document.querySelectorAll('.function-key')].find(btn => btn.textContent.includes('×'));
    appendValue('*');
  } else if (e.key === '/') {
    keyElement = [...document.querySelectorAll('.function-key')].find(btn => btn.textContent.includes('÷'));
    appendValue('/');
    e.preventDefault();
  } else if (e.key === '%') {
    keyElement = [...document.querySelectorAll('.function-key')].find(btn => btn.textContent.includes('%'));
    appendValue('%');
  } else if (e.key === '.') {
    keyElement = [...document.querySelectorAll('.key')].find(btn => btn.textContent.includes('.'));
    appendValue('.');
  } else if (e.key === 'Enter') {
    keyElement = document.querySelector('.equal');
    calculate();
    e.preventDefault();
  } else if (e.key === 'Backspace') {
    keyElement = document.querySelector('.function-key[onclick*="clearDisplay"]');
    clearDisplay();
    e.preventDefault();
  } else if (e.key === 'Escape') {
    keyElement = document.querySelector('.function-key[onclick*="allClear"]');
    allClear();
    e.preventDefault();
  }

  // 버튼 눌림 효과
  if (keyElement) {
    keyElement.style.transform = 'translateY(2px)';
    keyElement.style.boxShadow = '0 1px 0 rgba(0,0,0,0.2), 0 2px 4px rgba(0,0,0,0.3)';
    setTimeout(() => {
      keyElement.style.transform = '';
      keyElement.style.boxShadow = '';
    }, 100);
  }
});
</script>
</body>
</html>
